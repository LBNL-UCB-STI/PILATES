
# conda environment setup
# (eg on hima)
# Pilates is using python 3.8
# Note: while this was ran and most of Pilates seemed to work
# the workflow from run.py did not finish to completion, 
# and we migrated to use AMI circa Dec 2021
# -Tin


normal use
----------



eval "$(/opt/anaconda3/bin/conda shell.bash hook)"
conda activate pilates-conda-env

python run.py -v 


one time setup
--------------

install Anaconda3-2021.05-Linux-x86_64.sh to /opt/anaconda3 (as user)      /local/nvme/miniconda3 on ex4

##XX eval "$(/opt/anaconda3/bin/conda shell.bash hook)"
##XX conda config --set auto_activate_base false

conda init

conda env create -n pilates-conda-env -f ./environment.yml   # installed to /opt/anaconda3/env/pilates-conda-env 

conda activate pilates-conda-env
conda list
conda deactivate


(pilates-conda-env) **^ tin hima.lbl.gov ~/tin-gh/PILATES ^**>  which python
/opt/anaconda3/envs/pilates-conda-env/bin/python
(pilates-conda-env) **^ tin hima.lbl.gov ~/tin-gh/PILATES ^**>  which python2
/bin/python2
(pilates-conda-env) **^ tin hima.lbl.gov ~/tin-gh/PILATES ^**>  which python3
/opt/anaconda3/envs/pilates-conda-env/bin/python3
(pilates-conda-env) **^ tin hima.lbl.gov ~/tin-gh/PILATES ^**>  python --version
Python 3.8.12


ex4
----

2021.1118
##xx eval "$(~/anaconda3/bin/conda shell.bash hook)"
failed, have to figure out my conda mess, or install a local anaconda in /opt also
another day...

install miniconda3 to /local/nvme/miniconda3
eval "$(/local/nvme/miniconda3/bin/conda shell.bash hook)"
conda activate pilates-conda-env




data dirs

settings.yaml change one dir to use full path to 
usim_client_data_folder: /global/home/users/tin/tin-gh/4ling/pilates
was this not mapped to pilates/urbansim/data ?

mv 10.activitySimODSkims.UrbanSim.TAZ.Full.csv.gz  PILATES/pilates/beam/beam_output/
should this have been set differently?
also a bit surprised that the dir is not masked by container... probably cuz the parent dir was bind mounted.


/global/home/users/tin/tin-gh/4ling/pilates
/global/home/users/tin/tin-gh/4ling/pilates/PILATES/pilates/beam/beam_output/

chmod 777 on the files, so docker process can update them.


chmod 777 pilates/beam/beam_output/
chmod 777 pilates/beam/beam_output/10.activitySimODSkims.UrbanSim.TAZ.Full.csv.gz
chmod 777 pilates/urbansim/data
chmod 777 pilates/urbansim/data/custom_mpo_06197001_model_data.h5

new test:
chmod 777 pilates/activitysim/output/
